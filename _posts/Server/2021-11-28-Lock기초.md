---
layout: single
title: "C# Rookiss Part4 ê²Œì„ì„œë²„ : Lockê¸°ì´ˆ"
categories: Server
tags: Server
author_profile: false
sidebar:
  nav: "docs"

date: 2021-11-28
last_modified_at: 2024-11-11
---


## ğŸ™‡â€â™€ï¸Lock ê¸°ì´ˆ

ë™ì‹œ ë‹¤ë°œì ìœ¼ë¡œ ì ‘ê·¼í•˜ë©´ ë¬¸ì œê°€ ë˜ëŠ” ì½”ë“œ : ì„ê³„ì˜ì—­

ì„ê³„ì˜ì—­ì„ í•´ê²°í•˜ê¸°ìœ„í•œ Lock!

ìƒí˜¸ ë°°ì œì ì´ë‹¤

### ğŸªMonitor

ë¬¸ì„ ì ê·¸ê³  ì¼ë ¨ì˜ í–‰ìœ„ë¥¼ í•œí›„ ë¬¸ì„ í’€ì–´ì¤€ë‹¤ëŠ” ê°œë…

ë¬¸ì„ ì ê·¼ë’¤ì—ëŠ” ì‹±ê¸€ì“°ë ˆë“œë¡œ ìƒê°í•´ì„œ ì½”ë”©í•˜ë©´ ë¨

ë¬¸ì„ í’€ì–´ì£¼ëŠ” ê²ƒì´ ì¸ì…‰ì…˜, ì‹¤ìˆ˜ ë“±ìœ¼ë¡œ ëª»í• ê²½ìš° ë¬¸ì œê°€ ë¨ - ë°ë“œë½ (DeadLock)

```cs
static int number = 0;
static object _obj = new object();

static void Thread_1()
{
    // atomic = ì›ìì„±

    for (int i = 0; i < 100000; i++)
    {
        // ìƒí˜¸ë°°ì œ Mutual Exclusive
        
        // ìœˆë„ìš° : CriticalSection, c++ : std::mutex
        Monitor.Enter(_obj); // ë¬¸ì„ ê°êµ¬ëŠ” í–‰ìœ„

        number++;

        Monitor.Exit(_obj); // ì ê¸ˆì„ í’€ì–´ì¤€ë‹¤
    }
}

static void Thread_2()
{
    for (int i = 0; i < 100000; i++)
    {
        Monitor.Enter(_obj);

        number--;

        Monitor.Exit(_obj);
    }
}

static void Main(string[] args)
{
    Task t1 = new Task(Thread_1);
    Task t2 = new Task(Thread_2);
    t1.Start();
    t2.Start();

    Task.WaitAll(t1, t2);

    Console.WriteLine(number);
}
```

ê° ì–¸ì–´ë§ˆë‹¤ ì ê·¸ê³  í’€ì–´ì£¼ëŠ” ì—­í• ì„ í•˜ëŠ” ì• ë“¤ì´ ì¡´ì¬
* window - CriticalSection , c++ - std::mutex



### ğŸªLock

Monitor.Enterì™€ Monitor.Exitë¥¼ ìë™ì ìœ¼ë¡œ í•´ì£¼ëŠ” ê°œë…

_objê°€ ìë¬¼ì‡  ì—­í• ì„ í•¨


```cs
for (int i = 0; i < 100000; i++)
{
    lock (_obj)
    {
        number++;
    }
}
```
















