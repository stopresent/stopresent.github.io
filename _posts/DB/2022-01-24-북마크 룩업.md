---
layout: single
title: "Rookiss Part5 ë°ì´í„°ë² ì´ìŠ¤ : ë¶ë§ˆí¬ ë£©ì—…"
categories: DB
tags: DB
author_profile: false
sidebar:
  nav: "docs"
---


## ğŸ™‡â€â™€ï¸ë¶ë§ˆí¬ ë£©ì—…

**ë¶ë§ˆí¬ ë£©ì—…**

* Index Scanì´ í•­ìƒ ë‚˜ìœ ê²ƒì€ ì•„ë‹ˆê³ 
* Index Seekê°€ í•­ìƒ ì¢‹ì€ê²ƒì€ ì•„ë‹ˆë‹¤
* ì¸ë±ìŠ¤ë¥¼ í™œìš©í•˜ëŠ”ë° ì–´ë–»ê²Œ ëŠë¦´ ìˆ˜ê°€ ìˆì„ê¹Œ? => ë¶ë§ˆí¬ ë£©ì—…ì„ ì‚¬ìš©í•˜ê¸° ë•Œë¬¸

### ğŸªì°¨ê·¼ì°¨ê·¼

* Heap Table[ {PAGE} {PAGE} ]

* CLUSTEREDì˜ ê²½ìš° INDEX SEEKê°€ ëŠë¦´ ìˆ˜ê°€ ì—†ë‹¤
* NonClusteredì˜ ê²½ìš°, ë°ì´í„°ê°€ Leaf Pageì— ì—†ë‹¤
* ë”°ë¼ì„œ í•œë²ˆ ë” íƒ€ê³  ê°€ì•¼ë¨
  1. RID -> Heap Table (Bookbark Lookup)
  2. Key -> Clustered


```
SELECT *
INTO TestOrders
FROM Orders;

SELECT *
FROM TestOrders;

CREATE NONCLUSTERED INDEX Orders_Index01
ON TestOrders(CustomerID);
```


* ì¸ë±ìŠ¤ ë²ˆí˜¸

```
SELECT Index_id, name
FROM sys.indexes
WHERE object_id = object_id('TestOrders');
```


* ì¡°íšŒ

`DBCC IND('Northwind', 'TestOrders', 2);`


```
9000
8960 8968 8969
Heap Table[ {PAGE} {PAGE} ]
```


* ê±¸ë¦° ì‹œê°„, ë…¼ë¦¬ì  ì½ê¸° ìˆ˜, ì‹¤ì œ ë¡œì§ ê²½ë¡œ í™•ì¸

```
SET STATISTICS TIME ON;
SET STATISTICS IO ON;
SET STATISTICS PROFILE ON;
```


### ğŸªë¶„ì„ ì‹œì‘


* ê¸°ë³¸ íƒìƒ‰ì„ í•´ë³´ì

``` 
SELECT *
FROM TestOrders
WHERE CustomerID = 'QUICK';
```


* ê°•ì œë¡œ ì¸ë±ìŠ¤ë¥¼ ì´ìš©í•˜ê²Œ í•´ë³´ì

``` 
SELECT *
FROM TestOrders WITH INDEX(Orders_Index01)
WHERE CustomerID = 'QUICK';
```

ë…¼ë¦¬ì  ì½ê¸°ê°€ ëŠ˜ì—ˆìŒ => í•­ìƒ ì¸ë±ìŠ¤ê°€ ì´ë“ì¸ ê²ƒì€ ì•„ë‹ˆë‹¤



### ğŸªë£©ì—…ì„ ì¤„ì´ê¸° ìœ„í•œ ëª¸ë¶€ë¦¼


``` 
SELECT *
FROM TestOrders WITH INDEX(Orders_Index01)
WHERE CustomerID = 'QUICK' AND ShipVia = 3;
```

ROWê°€ 28ê°œì¸ê²ƒì„ ì•Œì§€ë§Œ ShipViaê°€ 3ì¸ê²ƒì€ ëª¨ë¥´ë¯€ë¡œ 20ê°œëŠ” ë»‘ì´ë‚˜ê³  8ê°œë§Œ ì‚´ì•„ë‚¨ìŒ


**ë£©ì—…ì„ ì¤„ì—¬ë³´ì**
ê²½í—˜ì— ë”°ë¼ ë°©ë²•ì´ ë‹¤ ë‹¤ë¥¸ë‹¤!


**ë³µí•©ì¸ë±ìŠ¤ë¥¼ í™œìš©**
* CORVERED INDEX
  * ëª¨ë“  ê²½ìš°, ì˜ì—­ì„ ì»¤ë²„í•˜ê² ë‹¤!

```
CREATE NONCLUSTERED INDEX Orders_Index01
ON TestOrders(CustomerID, ShipVia);
```

ì¸ë±ìŠ¤ SEEKê°€ 8ê°œë§Œ ì°¾ëŠ”ë‹¤
1. ë‘˜ ë‹¤ ë§Œì¡±í•˜ëŠ”ê²ƒë§Œ ì°¾ìœ¼ë‹ˆê¹Œ ë¦¬í”„í˜ì´ì§€ ìì²´ì—ì„œ íŒë‹¨ê°€ëŠ¥
2. Heap Table Lookupì„ í•  í•„ìš”ê°€ ì—†ë‹¤


Q) ê·¸ëŸ¼ ì¡°ê±´1 AND ì¡°ê±´2 í•„ìš”í•˜ë©´, ë¬´ì¡°ê±´ INDEX(ì¡°ê±´1, ì¡°ê±´2)ë¥¼ ì¶”ê°€í•´ì£¼ë©´ ì¥ë–™?
A) NO! ê¼­ ê·¸ë ‡ì§€ëŠ” ì•Šë‹¤. DML(INSERT, UPDATE, DELETE) ì‘ì—… ë¶€í•˜ê°€ ì¦ê°€í•˜ê²Œ ëœë‹¤


**INCLUDE í™œìš©**

```
CREATE NONCLUSTERED INDEX Orders_Index01
ON TestOrders(CustomerID) INCLUDE (ShipVia);
```

í‚¤ ê°’ ìì²´ëŠ” CustomerIDë§Œ ì‚¬ìš©í•˜ê¸°ì— ë¶€ë‹´ë˜ì§€ ì•Šì§€ë§Œ, ë¦¬í”„í˜ì´ì§€ì—ë‹¤ê°€ ShipViaì˜ ì •ë³´ë¥¼ ë„£ì–´ëŠ” ê²ƒ

ë°ì´í„° ìˆœì„œì—ëŠ” ì˜í–¥ì„ ì£¼ì§€ ì•ŠëŠ”ë‹¤!



* CLUSTERED INDEX í™œìš©
  * ìœ„ì™€ ê°™ì€ ëˆˆë¬¼ê²¨ìš´ ë…¸ë ¥ì—ë„ ë‹µì´ ì—†ì„ ë–„ ì‚¬ìš©
  * BU! CLUSTERED INDEXëŠ” í…Œì´ë¸”ë‹¹ 1ê°œë§Œ ì‚¬ìš© í•  ìˆ˜ ìˆë‹¤
 

### ğŸªê²°ë¡ 

**NONCLUSTERED INDEXê°€ ì•…ì˜í–¥ì„ ì£¼ëŠ” ê²½ìš°?**
* ë¶ë§ˆí¬ ë£©ì—…ì´ ì‹¬ê°í•œ ë¶€í•˜ë¥¼ ì•¼ê¸°í•  ë–„

**ëŒ€ì•ˆì€?**
1. Covered Index (ê²€ìƒ‰í•  ëª¨ë“  ì¹¼ëŸ¼ì„ í¬í•¨í•˜ê² ë‹¤)
2. Indexì—ë‹¤ê°€ Includeë¡œ íŒíŠ¸ë¥¼ ë‚¨ê¸´ë‹¤
3. Clustered ê³ ë ¤ (ë‹¨, 1ë²ˆë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ê¶ê·¹ê¸°..) -> NonClustered ì•…ì˜í–¥ì„ ì¤„ ìˆ˜ ìˆìŒ






