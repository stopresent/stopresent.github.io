---
title: "ë”°ë¼ ë°°ìš°ëŠ” Cì–¸ì–´ : 13"

categories:
  - C
tags:
  - C

author_profile: false

sidebar:
  nav: "docs"

date: 2022-05-13
last_modified_at: 2022-05-13
---

## ğŸ™‡â€â™€ï¸13

<br>

### ğŸªë©”ëª¨ë¦¬ ë ˆì´ì•„ì›ƒ í›‘ì–´ë³´ê¸°

* ëª…ë ¹ì¤„ ì¸ìˆ˜ì™€ í™˜ê²½ ë³€ìˆ˜ë“¤ Command-line arguments and environment variables
* ìŠ¤íƒ Stack (í¬ê¸° ë³€í•¨)
* ììœ  ê³µê°„ Free
* í™ Heap (í¬ê¸° ë³€í•¨)
* ì´ˆê¸°í™”ë˜ì§€ ì•Šì€ ì „ì—­/ì •ì  ë³€ìˆ˜ë“¤ BSS(Block Started by Symbol) Segment (í¬ê¸° ê³ ì •)
* ì´ˆê¸°í™”ëœ ì „ì—­/ì •ì  ë³€ìˆ˜ë“¤ DATA Segment (í¬ê¸° ê³ ì •)
* í”„ë¡œê·¸ë¨ ì½”ë“œ TEXT Segment (í¬ê¸° ê³ ì •)


<br>

### ğŸªê°ì²´ì™€ ì‹ë³„ì, lvalueì™€ rvalue

ê°ì²´ : Object

ì‹ë³„ì : Identifier

L-value : left side of an assignment

R-value : right side, variable, constant, expressions


<br>

### ğŸªë‚œìˆ˜ ìƒì„±ê¸° ëª¨ë“ˆ ë§Œë“¤ê¸° ì˜ˆì œ

```c
// my_rand.c

static unsigned int next = 1;

int my_rand()
{
	next = next * 1103515245 + 1234;
	next = (unsigned int)(next / 65536) % 32768;

	return (int)next;
}

void my_srand(unsigned int seed)
{
	next = seed;
}
```

```c
// my_rand.h

#pragma once

int my_rand();
void my_srand(unsigned int seed);
```


<br>

### ğŸªë©”ëª¨ë¦¬ ë™ì  í• ë‹¹

```c
int n = 0;

// n from files, internet, scanf, etc.

char* arr = (char*)malloc(sizeof(char) * n);

// ... 

free(arr);
```

<br>

```c
float x;
char str[] = "Dancing with a Star";

int arr[100];

/*
	malloc() returns a void type pointer.
	void* : generic pointer

	free() deallocates the memory
*/

double* ptr = NULL;

ptr = (double*)malloc(30 * sizeof(double));

if (ptr == NULL)
{
	puts("Memory allcation failed.");

	/*
		exit(EXIT_FALURE) is similar to return 1 IN main().
		exit(EXIT_SUCCESS) is similar to return 0 IN main().
	*/

	exit(EXIT_FAILURE);
}

printf("Before free %p\n", ptr);

free(ptr); // no action occurs when ptr is NULL

printf("After free %p\n", ptr);

ptr = NULL; // optional
```

mallocìœ¼ë¡œ ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í–ˆìœ¼ë©´ ê¼­ freeë¡œ í’€ì–´ì¤˜ì•¼ í•œë‹¤.

ptrì´ë€ ë³€ìˆ˜ëŠ” { }ì„ ë²—ì–´ë‚˜ë©´ ì‚¬ë¼ì§€ëŠ”ë° ë©”ëª¨ë¦¬ í• ë‹¹ì´ ì‚¬ë¼ì§„ ê²ƒì€ ì•„ë‹ˆë‹¤.

```c
/* Dynamically Allocated Array */

int n = 5;
ptr = (double*)malloc(n * sizeof(double));

if(ptr != NULL) // if(!ptr)
{
	for (int i = 0; i < n; i++)
		printf("%f", ptr[i]);
	printf("\n");

	for (int i = 0; i < n; i++)
		*(ptr + i) = (double)i;

	for (int i = 0; i < n; i++)
		printf("%f", ptr[i]);
	printf("\n");
}

free(ptr);
ptr = NULL;
```

ë™ì í• ë‹¹ì„ ì´ìš©í•œ ë°°ì—´ë§Œë“¤ê¸°!


<br>

### ğŸªë™ì  í• ë‹¹ ë©”ëª¨ë¦¬ë¥¼ ë°°ì—´ì²˜ëŸ¼ ì‚¬ìš©í•˜ê¸°

1ì°¨ì› ë°°ì—´
```c
int n = 3;
int* ptr = (int*)malloc(sizeof(int*) * n);
if (!ptr) exit(1);

ptr[0] = 123;
*(ptr + 1) = 456;
*(ptr + 2) = 789;

free(ptr);
ptr = NULL;
```

2ì°¨ì› ë°°ì—´ì„ 1ì°¨ì›ë°°ì—´ë¡œ ì‚¬ìš©í•˜ê¸°
```c
int row = 3, col = 2;
int* ptr = (int*)malloc(row * col * sizeof(int));
if (!ptr) exit(1);

for (int r = 0; r < row; r++)
	for (int c = 0; c < col; c++)
		ptr[c + col * r] = c + col * r;

for (int r = 0; r < row; r++)
{
	for (int c = 0; c < col; c++)
		printf("%d ", *(ptr + c + col * r));
	printf("\n");
}
```

<br>

### ğŸªcalloc(), realloc()

* calloc()
```c
int n = 10;

int* ptr = NULL;

ptr = (int*)calloc(n, sizeof(int)); // Contiguous allocation
if (!ptr) exit(1);

for (int i = 0; i < n; i++)
	printf("%d ", ptr[i]);
printf("\n");
```
callocì€ mallocê³¼ ë‹¤ë¥´ê²Œ ê°œìˆ˜ì™€ í¬ê¸°ë¥¼ ì…ë ¥ë°›ê³  freeë¥¼ ì•ˆí•´ì¤˜ë„ ëœë‹¤.

* realloc()
```c
/*
	realloc() KNK p. 422
	- doesn't initialize the bytes added
	- returns NULL if can't enlarge the memory block
	- If first argument is NULL, it behaves like malloc()
	- if second argument is 0, it frees the memory block.
*/

for (int i = 0; i < n; i++)
	ptr[i] = i + 1;

n = 20;

int* ptr2 = NULL;
ptr2 = (int*)realloc(ptr, n * sizeof(int));
//ptr = (int*)realloc(ptr, n * sizeof(int)); ë§ˆì¹˜ ê¸°ë³¸ ë©”ëª¨ë¦¬ í• ë‹¹ì´ ëŠ˜ì–´ë‚œ ê²ƒì²˜ëŸ¼ ì‚¬ìš©ê°€ëŠ¥.

printf("%p %p\n", ptr, ptr2);

printf("%d\n", ptr[0]);

if (!ptr2) exit(1);
else ptr = NULL; // ptrë¡œ reallocí–ˆë‹¤ë©´ ë¹¼ì•¼ë¨.

for (int i = 0; i < n; i++)
	printf("%d ", ptr2[i]); // copies data
printf("\n");

free(ptr2);
```
reallocì€ ì¬í• ë‹¹í•´ì£¼ëŠ” í•¨ìˆ˜ì¸ë° ë©”ëª¨ë¦¬ë¥¼ í• ë‹¹í•´ì¤€ê²ƒì—ì„œ ì¡°ì •í•  ë•Œ ì‚¬ìš©í•œë‹¤.